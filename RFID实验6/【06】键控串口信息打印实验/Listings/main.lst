C51 COMPILER V9.60.0.0   MAIN                                                              06/07/2023 12:40:45 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /******************************************************************
   2           * 实验名称：键控串口信息打印实验
   3           * 可配书籍：上册-《深入浅出STC8增强型51单片机进阶攻略》已经出版
   4                       下册-《深入浅出STC8增强型51单片机实战攻略》还在写作
   5           * 书籍备注：龙顺宇编著 清华大学出版社出版
   6           * 淘宝店铺：https://520mcu.taobao.com/
   7           * 实验平台：思修电子工作室SX-RFID-B低频ID识别与应用开发板 Long
   8           * 芯片型号：STC8G1K08/17（微调后可移植至STC8A/F/C/G/H系列单片机）
   9           * 时钟说明：芯片内部11.0592MHz，在使用STC-ISP软件时需要先配置然后
  10           *           下载到单片机使得时钟配置生效。
  11           * 串口速率：9600bps
  12           * 实验说明：用USB线插入到Uart-USB接口给开发板供电，做好STC-ISP配置
  13           并下载程序，在电脑上打开串口调试助手软件，选择对应的串口号（具体串
  14           口号可在电脑设备管理器中查询），然后配置波特率为9600bps，选择文本/
  15           字符模式接收数据，此时按下K1按键后串口将会接收到“【USER】:K1 is pr
  16           essed!”提示，按下K2按键后串口将会接收到“【USER】:K2 is pressed!”提
  17           示，以此学习串口资源编程及串口调试助手的使用。
  18          ******************************************************************/
  19          #include  "STC8G.h"       //主控芯片的头文件
  20          /************************常用数据类型定义*************************/
  21          #define u8  uint8_t
  22          #define u16 uint16_t
  23          #define u32 uint32_t
  24          typedef unsigned char    uint8_t;
  25          typedef unsigned int     uint16_t;
  26          typedef unsigned long    uint32_t;
  27          /************************端口/引脚定义区域************************/
  28          sbit KEY1=P3^4;           //按键1 
  29          sbit KEY2=P3^3;           //按键2
  30          /************************用户自定义数据区域***********************/
  31          #define FOSC 11059200UL   //系统外部时钟频率（无符号长整型）
  32          #define BAUD 9600         //欲配置的串口通信波特率值
  33          /**************************函数声明区域***************************/
  34          void delay(u16 Count);    //延时函数
  35          void IO_init(void);       //IO初始化函数
  36          void UART_init(void);     //串口初始化函数
  37          void SendData(u8 dat);    //串口发送单字节数据函数
  38          void SendString(u8 *s);   //串口发送字符串函数
  39          /***************************主函数区域****************************/
  40          void main(void)
  41          {
  42   1        IO_init();          //IO初始化  
  43   1        UART_init();        //串口初始化
  44   1        delay(100);         //等待配置稳定
  45   1        while(1)
  46   1        {
  47   2          if(KEY1==0)       //若K1按键按下
  48   2          {
  49   3            delay(5);       //软件延时去除按键抖动
  50   3            if(KEY1==0)     //若K1按键确实被按下
  51   3            {
  52   4              SendString("【USER】:K1 is pressed!\r\n");
  53   4              while(!KEY1); //等待用户按键松手
  54   4            }
C51 COMPILER V9.60.0.0   MAIN                                                              06/07/2023 12:40:45 PAGE 2   

  55   3          }
  56   2          if(KEY2==0)       //若K1按键按下
  57   2          {
  58   3            delay(5);       //软件延时去除按键抖动
  59   3            if(KEY2==0)     //若K1按键确实被按下
  60   3            {
  61   4              SendString("【USER】:K2 is pressed!\r\n");
  62   4              while(!KEY2); //等待用户按键松手
  63   4            }
  64   3          }
  65   2        }
  66   1      }
  67          /****************************************************************/
  68          //延时函数delay()，有形参Count用于控制延时函数执行次数，无返回值
  69          /****************************************************************/
  70          void delay(u16 Count)
  71          {
  72   1        u8 i,j;
  73   1        while (Count--)
  74   1        {
  75   2          for(i=0;i<50;i++)
  76   2            for(j=0;j<20;j++);
  77   2        }
  78   1      }
  79          /****************************************************************/
  80          //IO初始化函数IO_Init()，无形参，无返回值
  81          /****************************************************************/
  82          void IO_init(void)
  83          {
  84   1        //配置P3.3-4为准双向/弱上拉模式
  85   1        P3M0&=0xE7;     //P3M0.3-4=0
  86   1        P3M1&=0xE7;     //P3M1.3-4=0
  87   1        delay(10);      //等待I/O模式配置稳定
  88   1      }
  89          /****************************************************************/
  90          //串口初始化函数UART_init()，无形参，无返回值
  91          /****************************************************************/
  92          void UART_init(void)
  93          {
  94   1        SCON=0x50;      //8位数据,可变波特率
  95   1        AUXR|=0x40;     //定时器1时钟为Fosc,即1T
  96   1        AUXR&=0xFE;     //串口1选择定时器1为波特率发生器
  97   1        TMOD&=0x0F;     //设定定时器1为16位自动重装方式
  98   1        TL1=(65536-(FOSC/4/BAUD));   //设置波特率重装值
  99   1        TH1=(65536-(FOSC/4/BAUD))>>8;//设置波特率重装值
 100   1        ET1=0;          //禁止定时器1中断
 101   1        TR1=1;          //启动定时器1
 102   1        ES=1;           //使能UART中断开关ES
 103   1        EA=1;           //使能单片机总中断开关EA
 104   1      }
 105          /****************************************************************/
 106          //串口发送单字节数据SendData()，有形参dat用于接收欲发送的单字节
 107          //数据，无返回值
 108          /****************************************************************/
 109          void SendData(u8 dat)
 110          {
 111   1        SBUF=dat;       //发送数据到发送缓冲区内
 112   1        while(TI==0);   //等待串口数据发送完毕
 113   1        TI=0;           //清除发送完成标志位TI  
 114   1      }
 115          /****************************************************************/
 116          //串口发送字符串函数SendString()，有形参*s属于指针变量，用于指向
C51 COMPILER V9.60.0.0   MAIN                                                              06/07/2023 12:40:45 PAGE 3   

 117          //要发送的字符串首字节，通过指针的自增，逐一取出字符依次发送直至
 118          //字符串结束标志'\0',无返回值
 119          /****************************************************************/
 120          void SendString(u8 *s)
 121          {
 122   1        while(*s!='\0')
 123   1        {
 124   2          SendData(*s); //调用SendData()函数依次发送单字节数据
 125   2          s++;          //指针自增，便于发送下一个数据
 126   2        }
 127   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    173    ----
   CONSTANT SIZE    =     52    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
