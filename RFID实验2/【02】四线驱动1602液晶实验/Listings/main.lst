C51 COMPILER V9.60.0.0   MAIN                                                              06/07/2023 12:38:46 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*********************************************************************
   2           * 实验名称：四线驱动1602液晶实验
   3           * 可配书籍：上册-《深入浅出STC8增强型51单片机进阶攻略》已经出版
   4                       下册-《深入浅出STC8增强型51单片机实战攻略》还在写作
   5           * 书籍备注：龙顺宇编著 清华大学出版社出版
   6           * 淘宝店铺：https://520mcu.taobao.com/
   7           * 实验平台：思修电子工作室SX-RFID-B低频ID识别与应用开发板 Long
   8           * 芯片型号：STC8G1K08/17（微调后可移植至STC8A/F/C/G/H系列单片机）
   9           * 时钟说明：芯片内部11.0592MHz，在使用STC-ISP软件时需要先配置然后
  10           *           下载到单片机使得时钟配置生效。
  11           * 实验说明：断电前提下向开发板插入1602液晶模块，然后用USB线插入到
  12           Uart-USB接口给开发板供电，做好STC-ISP配置并下载程序，观察1602液晶
  13           的显示情况（第一行显示“==SYS PASSWORD==”，第二行显示*号进度条效果
  14           ），从而学习1602液晶串行四线驱动方法。
  15          *********************************************************************/
  16          #include  "STC8H.h"       //主控芯片的头文件
  17          /***************************常用数据类型定义*************************/
  18          #define u8  uint8_t
  19          #define u16 uint16_t
  20          #define u32 uint32_t
  21          typedef unsigned char  uint8_t;
  22          typedef unsigned int   uint16_t;
  23          typedef unsigned long  uint32_t;
  24          /***************************端口/引脚定义区域************************/
  25          sbit LCDRS=P3^6;          //LCD1602数据/命令选择端口
  26          sbit LCDEN=P3^7;          //LCD1602使能信号端口
  27          #define LCDDATA  P1       //LCD1602数据端口（仅用DB4至DB7）
  28          /***************************用户自定义数据区域***********************/
  29          u8 table1[]="==SYS PASSWORD==";//LCD1602显示字符串数组1
  30          u8 table2[]="****************";//LCD1602显示字符串数组2
  31          /*****************************函数声明区域***************************/
  32          void delay(u16 Count);    //延时函数
  33          void IO_init(void);       //IO初始化函数
  34          void LCD1602_Write(u8 cmdordata,u8 writetype);
  35          //写入液晶模组命令或数据函数
  36          void LCD1602_init(void);  //LCD1602初始化函数
  37          void LCD1602_DIS(void);   //显示字符函数
  38          /******************************主函数区域****************************/
  39          void main(void)
  40          {
  41   1        IO_init();        //IO初始化
  42   1        LCDEN=1;delay(200);//使能置“1”（防止复位乱码）
  43   1        LCDEN=0;delay(200);//使能清“0”（防止复位乱码）
  44   1        LCD1602_init();   //LCD1602初始化
  45   1        delay(200);       //延时等待稳定
  46   1        LCD1602_DIS();    //显示字符效果
  47   1        while(1);         //程序死循环“停止”
  48   1      }
  49          /********************************************************************/
  50          //延时函数delay()，有形参Count用于控制延时函数执行次数，无返回值
  51          /********************************************************************/
  52          void delay(u16 Count)
  53          {
  54   1        u8 i,j;
C51 COMPILER V9.60.0.0   MAIN                                                              06/07/2023 12:38:46 PAGE 2   

  55   1        while(Count--)
  56   1        {
  57   2          for(i=0;i<50;i++)
  58   2            for(j=0;j<20;j++);
  59   2        }
  60   1      }
  61          /********************************************************************/
  62          //IO初始化函数IO_Init()，无形参，无返回值
  63          /********************************************************************/
  64          void IO_init(void)
  65          {
  66   1        //配置P3.6-7为准双向/弱上拉模式
  67   1        P3M0&=0x3F;     //P3M0.6-7=0
  68   1        P3M1&=0x3F;     //P3M1.6-7=0
  69   1        //配置P1.0-3为准双向/弱上拉模式
  70   1        P1M0&=0xF0;     //P1M0.0-3=0
  71   1        P1M1&=0xF0;     //P1M1.0-3=0
  72   1        delay(10);      //等待I/O模式配置稳定
  73   1      }
  74          /********************************************************************/
  75          //LCD1602初始化函数LCD1602_init()，无形参和返回值
  76          /********************************************************************/
  77          void LCD1602_init(void)
  78          {
  79   1        //写法1：*******************************************************
  80   1      //  LCD1602_Write(0x32,0);delay(10);//0x32非命令，参见HD44780数据手册
  81   1      //  LCD1602_Write(0x28,0);delay(10);//数据总线为4位，显示2行，5*7点阵/每字符
  82   1      //  LCD1602_Write(0x0C,0);delay(10);//设置开显示，不显示光标
  83   1      //  LCD1602_Write(0x06,0);delay(10);//写入新数据后显示屏整体不移动仅光标右移
  84   1      //  LCD1602_Write(0x01,0);delay(10);//写入清屏命令
  85   1        //写法2：*******************************************************
  86   1        LCD1602_Write(0x28,0);delay(10);//数据总线为4位，显示2行，5*7点阵/每字符
  87   1        LCDEN=1;delay(10);              //使能置“1”
  88   1        LCDEN=0;delay(10);              //使能清“0”
  89   1        LCD1602_Write(0x0C,0);delay(10);//设置开显示，不显示光标
  90   1        LCD1602_Write(0x06,0);delay(10);//写入新数据后显示屏整体不移动仅光标右移
  91   1        LCD1602_Write(0x01,0);delay(10);//写入清屏命令
  92   1      }
  93          /********************************************************************/
  94          //显示字符函数LCD1602_DIS()，无形参和返回值
  95          /********************************************************************/
  96          void LCD1602_DIS(void)
  97          {
  98   1        u8 i;                 //定义控制循环变量i
  99   1        LCD1602_Write(0x80,0);//选择第一行
 100   1        delay(5);             //延时等待1602稳定
 101   1        for(i=0;i<16;i++)
 102   1        {
 103   2            LCD1602_Write(table1[i],1);//写入table1[]内容
 104   2            delay(1);
 105   2        }
 106   1        LCD1602_Write(0xC0,0);//选择第二行
 107   1        delay(5);             //延时等待1602稳定
 108   1        for(i=0;i<16;i++)
 109   1        {
 110   2            LCD1602_Write(table2[i],1);//写入table2[]内容
 111   2            delay(200);
 112   2        }
 113   1      }
 114          /********************************************************************/
 115          //写入液晶模组命令或数据函数LCD1602_Write()，有形参cmdordata
 116          //和writetype，无返回值
C51 COMPILER V9.60.0.0   MAIN                                                              06/07/2023 12:38:46 PAGE 3   

 117          /********************************************************************/
 118          void LCD1602_Write(u8 cmdordata,u8 writetype)
 119          {
 120   1        u8 temp=0;                //定义数据处理中间变量
 121   1        LCDRS=writetype;          //判断写入类型0为命令1为数据
 122   1        delay(2);                 //延时等待稳定
 123   1        LCDDATA&=0xF0;            //清数据引脚
 124   1        temp=cmdordata>>4;        //高四位移到低四位
 125   1        LCDDATA|=temp&0x0F;       //写高四位
 126   1        LCDEN=1;delay(2);         //使能置“1”
 127   1        LCDEN=0;delay(2);         //使能清“0”
 128   1        LCDDATA&=0xF0;            //清数据引脚
 129   1        LCDDATA|=cmdordata&0x0F;  //写低四位
 130   1        LCDEN=1;delay(2);         //使能置“1”
 131   1        LCDEN=0;delay(2);         //使能清“0”
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    317    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     34       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
